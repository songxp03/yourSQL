var lbm_canvas;var lbm_worker;var lbm_btn_run;var lbm_btn_stop;var lbm_btn_continue;var lbm_select;var lbm_range_steps;var lbm_span_steps;var GRID_SIZE_X=300;var GRID_SIZE_Y=300;var STEPS=10;var MAX_STEPS=100;var SCALE=1;var SCENARIOS={0:"A",1:"B",2:"C",3:"D"};var mouse_x,mouse_y;function on_body_load(){lbm_btn_run=document.getElementById("lbm_btn_run");lbm_btn_stop=document.getElementById("lbm_btn_stop");lbm_btn_continue=document.getElementById("lbm_btn_continue");lbm_range_steps=document.getElementById("lbm_range_steps");lbm_range_steps.min=1;lbm_range_steps.max=MAX_STEPS;lbm_range_steps.value=STEPS;lbm_span_steps=document.getElementById("lbm_span_steps");lbm_span_steps.textContent=STEPS;lbm_canvas=document.getElementById("lbm_canvas");lbm_canvas.setAttribute("height",GRID_SIZE_Y*SCALE+"px");lbm_canvas.setAttribute("width",GRID_SIZE_X*SCALE+"px");lbm_canvas.onclick=mouse_click;lbm_canvas.onmousemove=mouse_moved;lbm_select=document.getElementById("lbm_select");for(var e in SCENARIOS){if(SCENARIOS.hasOwnProperty(e)){var t=document.createElement("option");t.value=e;t.text=SCENARIOS[e];lbm_select.add(t)}}lbm_worker=new Worker("./js/lbm.min.js");console.log("start worker!");lbm_worker.onmessage=worker_message;set_lbm_options({numBubble:10,xSize:GRID_SIZE_X*SCALE,ySize:GRID_SIZE_Y*SCALE});draw_init(GRID_SIZE_X,GRID_SIZE_Y,SCALE)}function worker_command(e,t){lbm_worker.postMessage({cmd:e,value:t})}function set_lbm_options(e){worker_command("set",e)}function lbm_steps_changed(){set_lbm_options({steps_per_frame:lbm_range_steps.value});lbm_span_steps.textContent=Number(lbm_range_steps.value)}function lbm_run(){worker_command("select",lbm_select.value);worker_command("run")}function lbm_stop(){worker_command("stop")}function lbm_continue(){worker_command("continue")}function mouse_moved(e){var t=lbm_canvas.getBoundingClientRect();mouse_x=Math.floor((e.clientX-t.left)*lbm_canvas.width/(t.right-t.left)/SCALE);mouse_y=Math.floor((e.clientY-t.top)*lbm_canvas.height/(t.bottom-t.top)/SCALE)}function mouse_click(){worker_command("mouse_click",{mouse_x:mouse_x,mouse_y:mouse_y})}var lbm_canvas;var lbm_context;var image_data;var canvas_scale,canvas_width,canvas_height;var bubbles;var velocities_x,velocities_y,velocities_lengths;function draw_init(e,t,n){canvas_scale=n;lbm_canvas=document.getElementById("lbm_canvas");canvas_width=lbm_canvas.width;canvas_height=lbm_canvas.height;lbm_context=lbm_canvas.getContext("2d");draw()}function worker_message(e){try{var t=JSON.parse(e.data);switch(t.cmd){case"update":bubbles=t.value.bubbles;break}}catch(e){console.error(e)}}function draw(){if(bubbles){redraw(lbm_context)}requestAnimationFrame(draw)}function redraw(t){if(!t){lbm_canvas=document.getElementById("lbm_canvas");t=lbm_canvas.getContext("2d")}t.clearRect(0,0,canvas_width,canvas_height);bubbles.forEach(e=>{t.beginPath();t.arc(e.x,e.y,e.r,0,2*Math.PI);t.stroke()})}