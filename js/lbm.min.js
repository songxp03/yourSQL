var xSize,ySize;var numBubble=0;var bubbles;function Bubble(e,i,t){this.x=e;this.y=i;this.r=t}function Vec2(e,i){this.x=e;this.y=i;this.mult=function(e){this.x*=e;this.y*=e};this.addVec2=function(e){this.x+=e.x;this.y+=e.y};this.dot=function(e){return this.x*e.x+this.y*e.y}}var stop=true;function simulate(){if(!stop){message("update",{bubbles:bubbles});for(var e=0;e<bubbles.length;e++){item=bubbles[e];item.x+=(Math.random()-.5)*2;item.y+=(Math.random()-.5)*2;for(var i,t,s,b,u,a=0;e!=a&&a<bubbles.length;a++){t=item.x;s=item.y;b=bubbles[a].x;u=bubbles[a].y;i=(t-b)*(t-b)+(s-u)*(s-u);if(Math.sqrt(i)<item.r+bubbles[a].r+1){item.r=Math.pow(item.r*item.r*item.r+bubbles[a].r*bubbles[a].r*bubbles[a].r,1/3);bubbles.splice(a,1);break}}if(item.x<0)item.x+=xSize;if(item.y<0)item.y+=ySize;if(item.x>xSize)item.x-=xSize;if(item.y>ySize)item.y-=ySize}setTimeout(simulate,0)}}function run_sim(){stop_sim();start_sim()}function stop_sim(){stop=true}function start_sim(){if(numBubble>2){stop=false;simulate()}}function mouse_click(e,i){}function message(e,i){postMessage(JSON.stringify({cmd:e,value:i}))}self.onmessage=function(e){var i=e.data.cmd;var t=e.data.value;switch(i){case"set":init(t);break;case"run":run_sim();break;case"stop":stop_sim();break;case"continue":start_sim();break;case"mouse_click":mouse_click(t.mouse_x,t.mouse_y);break;case"select":break}};function init(e){numBubble=e.numBubble;xSize=e.xSize;ySize=e.ySize;bubbles=new Array(numBubble);console.log("numBubble=",numBubble,"x/y Size:",xSize,"x",ySize);for(var i,t,s,b=0;b<numBubble;b++){i=xSize*Math.random();t=ySize*Math.random();s=20*Math.random();bubbles[b]=new Bubble(i,t,s)}}